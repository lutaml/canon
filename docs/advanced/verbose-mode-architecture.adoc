---
title: Verbose Mode Architecture
parent: Advanced
nav_order: 3
---
= Canon verbose mode guide
:toc:
:toclevels: 3

== Purpose

Canon provides a two-tier verbose output architecture for debugging comparison failures. This document explains the output structure, when to use each tier, and implementation details.

== Overview

Canon's verbose mode enhances diff output with configuration tables and summaries:

* **Diffs**: Always shown when files differ (default behavior)
* **Configuration Tables**: Shown with `--verbose` flag or `CANON_VERBOSE=1`
* **Semantic Diff Report**: Always shown when differences exist in verbose mode

The `--verbose` flag adds diagnostic information, not gates diff display.

== Architecture

The output architecture follows a clear three-tier structure:

[source]
----
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              CANON DIFF OUTPUT ARCHITECTURE                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

When files differ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 1: Configuration Tables (with --verbose flag)                  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Match Options Table (if CANON_VERBOSE=1)                       â”‚ â”‚
â”‚  â”‚  â€¢ Shows preprocessing behavior                                â”‚ â”‚
â”‚  â”‚  â€¢ Shows dimension behaviors (strict/normalize/ignore)         â”‚ â”‚
â”‚  â”‚  â€¢ Explains what each setting means                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Formatter Options Table (if CANON_VERBOSE=1)                   â”‚ â”‚
â”‚  â”‚  â€¢ Shows mode (by_line vs by_object)                           â”‚ â”‚
â”‚  â”‚  â€¢ Shows context_lines, diff_grouping_lines                    â”‚ â”‚
â”‚  â”‚  â€¢ Shows show_diffs filter setting                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Comparison Result Summary (if CANON_VERBOSE=1)                 â”‚ â”‚
â”‚  â”‚  â€¢ Equivalent? (YES/NO)                                        â”‚ â”‚
â”‚  â”‚  â€¢ Normative/Informative/Total diff counts                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 2: Semantic Diff Report (if --verbose and diffs exist)        â”‚
â”‚                                                                      â”‚
â”‚  For each difference:                                               â”‚
â”‚   â€¢ XPath location (e.g., /html/body/div/table/pre/text)           â”‚
â”‚   â€¢ Dimension classification (attribute_presence, text_content)     â”‚
â”‚   â€¢ Specific changes (Added: +xmlns:v, +xmlns:o)                    â”‚
â”‚   â€¢ Normative/Informative status                                    â”‚
â”‚   â€¢ Dimension-specific formatting                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 3: Detailed Diff (ALWAYS when files differ)                   â”‚
â”‚                                                                      â”‚
â”‚  Either:                                                            â”‚
â”‚   â€¢ Line-by-line diff (for HTML, or with --diff-mode by_line)      â”‚
â”‚   â€¢ Object tree diff (for XML/JSON/YAML, or with --diff-mode       â”‚
â”‚     by_object)                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
----

=== Output flow

The `DiffCommand` and `DiffFormatter.format_comparison_result()` orchestrate output:

. Always show diff when files differ (Tier 3)
. If `--verbose`: Add configuration tables (Tier 1 if CANON_VERBOSE=1)
. If `--verbose` and diffs exist: Add Semantic Diff Report (Tier 2)

== Semantic diff report

=== Purpose

The Semantic Diff Report is the core verbose output, always shown when differences exist. It provides dimension-specific, actionable details for each difference.

Unlike the detailed diff (which shows every changed line), the Semantic Diff Report shows a high-level summary of WHAT changed and WHY it matters.

=== Output format

[example]
====
[source]
----
======================================================================
  SEMANTIC DIFF REPORT (1 difference)
======================================================================

ğŸ” DIFFERENCE #1/1 [NORMATIVE]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Dimension:  attribute_presence
Location:   /html

âŠ– Expected (File 1):
   <html> with 2 attributes: lang, xmlns:epub

âŠ• Actual (File 2):
   <html> with 6 attributes: lang, xmlns:epub, xmlns:m, xmlns:o,
                              xmlns:v, xmlns:w

âœ¨ Changes:
   Added: +xmlns:m, +xmlns:o, +xmlns:v, +xmlns:w

======================================================================
----
====

=== Format structure

Each difference displays:

* **Status indicator**: `[NORMATIVE]` (green) or `[INFORMATIVE]` (yellow)
* **Dimension**: Which aspect differs (colorized in magenta)
* **Location**: XPath for XML/HTML, path for JSON/YAML (colorized in blue)
* **Expected section**: What was in File 1 (red heading, bold)
* **Actual section**: What was in File 2 (green heading, bold)
* **Changes summary**: Actionable description of the difference (yellow, bold)

=== Dimension-specific formats

==== Attribute presence differences

For missing or extra attributes:

[example]
====
[source]
----
Dimension:  attribute_presence
Location:   /html/body/p

âŠ– Expected: <p> with 2 attributes: id, lang
âŠ• Actual:   <p> with 4 attributes: id, lang, data-value, aria-label

âœ¨ Changes: Added: +data-value, +aria-label
----
====

Shows:

* Element name (`<p>`)
* How many attributes each has
* Which attributes were added (green with `+` prefix) or removed (red with `-` prefix)

==== Attribute value differences

For differing attribute values:

[example]
====
[source]
----
Dimension:  attribute_values
Location:   /html/body/div

âŠ– Expected: <div> class="  container  fluid  "
âŠ• Actual:   <div> class="container fluid"

âœ¨ Changes: Whitespace normalization difference
----
====

Shows:

* Which specific attribute differs (highlighted in cyan)
* Exact values on both sides
* Analysis: "Whitespace difference only", "Whitespace normalization difference", or "Value changed"

==== Text content differences

For text that differs:

[example]
====
[source]
----
Dimension:  text_content
Location:   /html/body/div/table/tbody/tr/td/pre/text

âŠ– Expected: <text> "
                     puts \"Hello, world.\"
                     "
âŠ• Actual:   <text> "puts \"Hello, world.\" "

âœ¨ Changes: âš ï¸  Whitespace preserved (inside <pre>, <code>, etc. -
            whitespace is significant)
----
====

Shows:

* Text preview (truncated at 100 characters)
* Special warning if inside `<pre>`, `<code>`, `<textarea>`, `<script>`, or `<style>` elements (where whitespace is significant)

==== Structural whitespace differences

For whitespace-only differences (usually informative):

[example]
====
[source]
----
Dimension:  structural_whitespace
Location:   /root/p

âŠ– Expected: <p> "helloâ£â£world"
âŠ• Actual:   <p> "helloâ£world"

âœ¨ Changes: Whitespace-only difference (informative)
----
====

Shows:

* Whitespace visualized: `â£` for space, `â†’` for tab, `â†µ` for newline
* Marked as `[INFORMATIVE]` (yellow)

==== JSON/YAML differences

For JSON/YAML path-based differences:

[example]
====
[source]
----
Dimension:  15
Location:   user.email

âŠ– Expected: user.email = "alice@example.com"
âŠ• Actual:   user.email = "bob@example.com"

âœ¨ Changes: Value changed
----
====

== CANON VERBOSE mode

=== Purpose

CANON VERBOSE mode adds detailed option tables BEFORE the Semantic Diff Report. These tables help understand:

* What match options are in effect
* How the diff formatter is configured
* Statistics about the comparison result

To enable, set the `CANON_VERBOSE` environment variable:

[source,bash]
----
CANON_VERBOSE=1 bundle exec rspec spec/my_failing_spec.rb:123
----

=== Match options table

Shows preprocessing and dimension behaviors:

[example]
====
[source]
----
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                       Match Options (HTML)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dimension          â”‚ Behavior  â”‚ Meaning                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ preprocessing      â”‚ rendered  â”‚ As browser-rendered (compacted whâ€¦ â”‚
â”‚ text_content       â”‚ normalize â”‚ Normalized then compared (normative)  â”‚
â”‚ structural_whitâ€¦   â”‚ ignore    â”‚ Differences IGNORED (informative)     â”‚
â”‚ attribute_presence â”‚ strict    â”‚ Must match exactly (normative)        â”‚
â”‚ attribute_values   â”‚ normalize â”‚ Normalized then compared (normative)  â”‚
â”‚ comments           â”‚ ignore    â”‚ Differences IGNORED (informative)     â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
----
====

Preprocessing behaviors:

* `:none` - No preprocessing (compare as-is)
* `:c14n` - Canonicalize (XML C14N normalization)
* `:normalize` - Normalize (collapse whitespace, trim lines)
* `:format` - Pretty-format (consistent indentation)
* `:rendered` - As browser-rendered (compacted whitespace, to_html)

Dimension behaviors:

* `:ignore` - Differences IGNORED (informative, won't fail test)
* `:strict` - Must match exactly (normative, will fail test)
* `:normalize` - Normalized then compared (normative if different after normalization)
* `:strip` - Strip leading/trailing whitespace only
* `:compact` - Collapse whitespace runs to single space

=== Formatter options table

Shows diff formatting settings:

[example]
====
[source]
----
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                         Formatter Options                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Option              â”‚ Value   â”‚ Impact                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mode                â”‚ by_line â”‚ Line-by-line diff                  â”‚
â”‚ context_lines       â”‚ 3       â”‚ 3 lines of context around diffs    â”‚
â”‚ show_diffs          â”‚ all     â”‚ Show all diffs (normative + informative) â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
----
====

=== Comparison result summary

Shows diff statistics:

[example]
====
[source]
----
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                      Comparison Result Summary                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Equivalent?    â”‚ âœ— NO    â”‚ Documents have semantic differences      â”‚
â”‚ Normative Diffs   â”‚ 1 diffs â”‚ Semantic differences that matter         â”‚
â”‚ Informative Diffs â”‚ 0       â”‚ Textual/formatting differences (ignored) â”‚
â”‚ Total Diffs    â”‚ 1       â”‚ All differences found                    â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
----
====

== Usage

=== Using in RSpec matchers

Verbose mode is activated by using `verbose: true` in the comparison:

[source,ruby]
----
result = Canon::Comparison::XmlComparator.equivalent?(
  xml1,
  xml2,
  verbose: true
)
# Returns ComparisonResult object
# Semantic Diff Report shown if differences exist
----

With RSpec matchers, verbose mode is automatic on test failure:

[source,ruby]
----
# Semantic Diff Report automatically shown on failure
expect(actual_html).to be_html4_equivalent_to(expected_html)
----

To enable CANON VERBOSE tables:

[source,bash]
----
CANON_VERBOSE=1 bundle exec rspec spec/my_spec.rb:123
----

=== Using via CLI

[source,bash]
----
# Verbose mode (shows Semantic Diff Report)
canon diff file1.xml file2.xml --verbose

# With CANON VERBOSE tables
CANON_VERBOSE=1 canon diff file1.xml file2.xml --verbose
----

=== Configuration

You can enable CANON VERBOSE mode permanently for a project:

[source,ruby]
----
# In spec/spec_helper.rb
ENV['CANON_VERBOSE'] = '1' if ENV['DEBUG']

# Or in your test
before(:each) do
  ENV['CANON_VERBOSE'] = '1'
end
----

== Implementation

=== DiffDetailFormatter module

Location: `lib/canon/diff_formatter/diff_detail_formatter.rb`

Responsible for:

* Formatting the Semantic Diff Report
* Dispatching to dimension-specific formatters
* Extracting XPath/JSON paths
* Detecting whitespace-preserving elements (`<pre>`, `<code>`, etc.)
* Colorizing output

Key methods:

* `format_report(differences)` - Main entry point
* `format_attribute_presence_details()` - Format attribute presence diffs
* `format_attribute_values_details()` - Format attribute value diffs
* `format_text_content_details()` - Format text content diffs
* `extract_xpath(node)` - Extract XPath with safety limits
* `inside_preserve_element?(node)` - Detect whitespace preservation

=== DebugOutput module

Location: `lib/canon/diff_formatter/debug_output.rb`

Responsible for:

* Rendering CANON VERBOSE option tables
* Checking if `CANON_VERBOSE=1` is set
* Formatting match options with descriptions
* Formatting formatter options with impact
* Formatting comparison summary statistics

Key methods:

* `verbose_tables_only()` - Returns CANON VERBOSE tables or empty string
* `format_match_options_table()` - Render match options as table
* `format_formatter_options_table()` - Render formatter options as table
* `format_comparison_summary()` - Render result summary as table

=== DiffFormatter integration

Location: `lib/canon/diff_formatter.rb`

The `format_comparison_result()` method orchestrates output:

[source,ruby]
----
def format_comparison_result(comparison_result, expected, actual)
  output = []

  # 1. CANON VERBOSE tables (ONLY if CANON_VERBOSE=1)
  output << DebugOutput.verbose_tables_only(...)

  # 2. Semantic Diff Report (ALWAYS if diffs exist)
  output << DiffDetailFormatter.format_report(...)

  # 3. Detailed diff (ALWAYS)
  output << format(differences, ...)

  output.compact.join("\n")
end
----

This ensures the correct output order and separation of concerns.

== See also

* link:../features/diff-formatting/[Diff Formatting] - Diff output customization
* link:../understanding/comparison-pipeline.adoc[Comparison Pipeline] - 4-layer architecture
* link:../interfaces/rspec/[RSpec Matchers] - Using verbose mode in tests
* link:../interfaces/cli/[CLI] - Command-line verbose mode